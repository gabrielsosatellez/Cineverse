{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{formatDateTime,fetchData}from\"../../utils/api\";import SeatGrid from\"./SeatGrid\";import SeatModal from\"./SeatModal\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function TicketsSection(_ref){let{sessions,selectedSession,setSelectedSession,takenSeats,setTakenSeats}=_ref;const[showSeatModal,setShowSeatModal]=useState(false);const[selectedSeat,setSelectedSeat]=useState(null);const[seatInfo,setSeatInfo]=useState(\"\");const[newSeat,setNewSeat]=useState(\"\");useEffect(()=>{if(!selectedSession)return;const interval=setInterval(()=>{fetchData(\"http://localhost:8080/api/tickets/session/\".concat(selectedSession.id)).then(data=>setTakenSeats(data.map(t=>t.seatNumber))).catch(err=>console.error(err));},3000);return()=>clearInterval(interval);},[selectedSession,setTakenSeats]);const handleSeatClick=async seatNumber=>{try{const response=await fetch(\"http://localhost:8080/api/tickets/session/\".concat(selectedSession.id,\"/seat/\").concat(seatNumber));const data=response.ok?await response.json():{occupied:false};if(data.occupied){setSeatInfo(\"Asiento \".concat(seatNumber,\" ocupado por \").concat(data.username));}else{setSeatInfo(\"Asiento \".concat(seatNumber,\" disponible\"));}setSelectedSeat(seatNumber);setShowSeatModal(true);}catch(err){console.error(err);}};const refreshSeats=async()=>{if(!selectedSession)return;const data=await fetchData(\"http://localhost:8080/api/tickets/session/\".concat(selectedSession.id));setTakenSeats(data.map(t=>t.seatNumber));};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold mb-4\",children:\"Gestionar entradas\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"border p-2 mb-4\",required:true,value:(selectedSession===null||selectedSession===void 0?void 0:selectedSession.id)||\"\",onChange:e=>{const session=sessions.find(s=>s.id===Number(e.target.value));if(!session)return;setSelectedSession(session);fetchData(\"http://localhost:8080/api/tickets/session/\".concat(session.id)).then(data=>setTakenSeats(data.map(t=>t.seatNumber)));},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",disabled:true,children:\"Selecciona sesi\\xF3n\"}),[...sessions].sort((a,b)=>new Date(a.dateTime)-new Date(b.dateTime)).map(s=>/*#__PURE__*/_jsxs(\"option\",{value:s.id,children:[s.movie.title,\" \\u2014 \",s.room.name,\" \\u2014 \",formatDateTime(s.dateTime)]},s.id))]}),selectedSession&&/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-5xl mx-auto mt-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mb-3 text-lg font-semibold flex justify-center items-center gap-6\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[selectedSession.room.name,\" \\xB7 \",selectedSession.room.totalSeats,\" asientos\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-red-600\",children:[\"Ocupados: \",takenSeats.length]}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-green-600\",children:[\"Libres: \",selectedSession.room.totalSeats-takenSeats.length]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-300 text-center py-1 mb-5 rounded font-bold w-2/3 mx-auto\",children:\"PANTALLA\"}),/*#__PURE__*/_jsx(SeatGrid,{selectedSession:selectedSession,takenSeats:takenSeats,onSeatClick:handleSeatClick})]}),/*#__PURE__*/_jsx(SeatModal,{isOpen:showSeatModal,seatInfo:seatInfo,selectedSeat:selectedSeat,selectedSession:selectedSession,takenSeats:takenSeats,setTakenSeats:setTakenSeats,newSeat:newSeat,setNewSeat:setNewSeat,onClose:()=>{setShowSeatModal(false);setSelectedSeat(null);setSeatInfo(\"\");setNewSeat(\"\");},onRefresh:refreshSeats})]});}","map":{"version":3,"names":["React","useState","useEffect","formatDateTime","fetchData","SeatGrid","SeatModal","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","TicketsSection","_ref","sessions","selectedSession","setSelectedSession","takenSeats","setTakenSeats","showSeatModal","setShowSeatModal","selectedSeat","setSelectedSeat","seatInfo","setSeatInfo","newSeat","setNewSeat","interval","setInterval","concat","id","then","data","map","t","seatNumber","catch","err","console","error","clearInterval","handleSeatClick","response","fetch","ok","json","occupied","username","refreshSeats","children","className","required","value","onChange","e","session","find","s","Number","target","disabled","sort","a","b","Date","dateTime","movie","title","room","name","totalSeats","length","onSeatClick","isOpen","onClose","onRefresh"],"sources":["C:/WareHouse/school/dam_2do/proyecto/Proyecto Final/Cineverse_web/cineverse-web/src/components/tickets/TicketsSection.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { formatDateTime, fetchData } from \"../../utils/api\";\r\nimport SeatGrid from \"./SeatGrid\";\r\nimport SeatModal from \"./SeatModal\";\r\n\r\nexport default function TicketsSection({ sessions, selectedSession, setSelectedSession, takenSeats, setTakenSeats }) {\r\n  const [showSeatModal, setShowSeatModal] = useState(false);\r\n  const [selectedSeat, setSelectedSeat] = useState(null);\r\n  const [seatInfo, setSeatInfo] = useState(\"\");\r\n  const [newSeat, setNewSeat] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    if (!selectedSession) return;\r\n\r\n    const interval = setInterval(() => {\r\n      fetchData(`http://localhost:8080/api/tickets/session/${selectedSession.id}`)\r\n        .then(data => setTakenSeats(data.map(t => t.seatNumber)))\r\n        .catch(err => console.error(err));\r\n    }, 3000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, [selectedSession, setTakenSeats]);\r\n\r\n  const handleSeatClick = async (seatNumber) => {\r\n    try {\r\n      const response = await fetch(\r\n        `http://localhost:8080/api/tickets/session/${selectedSession.id}/seat/${seatNumber}`\r\n      );\r\n      const data = response.ok ? await response.json() : { occupied: false };\r\n\r\n      if (data.occupied) {\r\n        setSeatInfo(`Asiento ${seatNumber} ocupado por ${data.username}`);\r\n      } else {\r\n        setSeatInfo(`Asiento ${seatNumber} disponible`);\r\n      }\r\n      setSelectedSeat(seatNumber);\r\n      setShowSeatModal(true);\r\n    } catch (err) {\r\n      console.error(err);\r\n    }\r\n  };\r\n\r\n  const refreshSeats = async () => {\r\n    if (!selectedSession) return;\r\n    const data = await fetchData(`http://localhost:8080/api/tickets/session/${selectedSession.id}`);\r\n    setTakenSeats(data.map(t => t.seatNumber));\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <h2 className=\"text-2xl font-bold mb-4\">Gestionar entradas</h2>\r\n\r\n      <select\r\n        className=\"border p-2 mb-4\"\r\n        required\r\n        value={selectedSession?.id || \"\"}\r\n        onChange={e => {\r\n          const session = sessions.find(s => s.id === Number(e.target.value));\r\n          if (!session) return;\r\n\r\n          setSelectedSession(session);\r\n          fetchData(`http://localhost:8080/api/tickets/session/${session.id}`)\r\n            .then(data => setTakenSeats(data.map(t => t.seatNumber)));\r\n        }}\r\n      >\r\n        <option value=\"\" disabled>Selecciona sesión</option>\r\n        {[...sessions]\r\n          .sort((a, b) => new Date(a.dateTime) - new Date(b.dateTime))\r\n          .map(s => (\r\n            <option key={s.id} value={s.id}>\r\n              {s.movie.title} — {s.room.name} — {formatDateTime(s.dateTime)}\r\n            </option>\r\n          ))}\r\n      </select>\r\n\r\n      {selectedSession && (\r\n        <div className=\"max-w-5xl mx-auto mt-4\">\r\n          {/* INFO SALA */}\r\n          <div className=\"text-center mb-3 text-lg font-semibold flex justify-center items-center gap-6\">\r\n            <span>\r\n              {selectedSession.room.name} · {selectedSession.room.totalSeats} asientos\r\n            </span>\r\n            <span className=\"text-red-600\">\r\n              Ocupados: {takenSeats.length}\r\n            </span>\r\n            <span className=\"text-green-600\">\r\n              Libres: {selectedSession.room.totalSeats - takenSeats.length}\r\n            </span>\r\n          </div>\r\n\r\n          {/* PANTALLA */}\r\n          <div className=\"bg-gray-300 text-center py-1 mb-5 rounded font-bold w-2/3 mx-auto\">\r\n            PANTALLA\r\n          </div>\r\n\r\n          {/* SALA */}\r\n          <SeatGrid\r\n            selectedSession={selectedSession}\r\n            takenSeats={takenSeats}\r\n            onSeatClick={handleSeatClick}\r\n          />\r\n        </div>\r\n      )}\r\n\r\n      {/* MODAL ASIENTOS */}\r\n      <SeatModal\r\n        isOpen={showSeatModal}\r\n        seatInfo={seatInfo}\r\n        selectedSeat={selectedSeat}\r\n        selectedSession={selectedSession}\r\n        takenSeats={takenSeats}\r\n        setTakenSeats={setTakenSeats}\r\n        newSeat={newSeat}\r\n        setNewSeat={setNewSeat}\r\n        onClose={() => {\r\n          setShowSeatModal(false);\r\n          setSelectedSeat(null);\r\n          setSeatInfo(\"\");\r\n          setNewSeat(\"\");\r\n        }}\r\n        onRefresh={refreshSeats}\r\n      />\r\n    </>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}