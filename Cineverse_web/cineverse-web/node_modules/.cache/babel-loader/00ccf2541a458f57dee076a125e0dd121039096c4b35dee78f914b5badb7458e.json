{"ast":null,"code":"import _objectSpread from\"C:/WareHouse/school/dam_2do/proyecto/Proyecto Final/Cineverse_web/cineverse-web/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState}from\"react\";import{fetchData,putData}from\"../../utils/api\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function UsersSection(){const[users,setUsers]=useState([]);const[query,setQuery]=useState(\"\");const[loading,setLoading]=useState(false);const[savingId,setSavingId]=useState(null);const[confirmOpen,setConfirmOpen]=useState(false);const[confirmUserId,setConfirmUserId]=useState(null);const[confirmNewRole,setConfirmNewRole]=useState(null);const[confirmUserName,setConfirmUserName]=useState(\"\");const loadUsers=async()=>{setLoading(true);try{const data=await fetchData(\"http://localhost:8080/api/users\");setUsers(Array.isArray(data)?data:[]);}catch(e){console.error(e);setUsers([]);}finally{setLoading(false);}};useEffect(()=>{loadUsers();},[]);// Open confirmation modal instead of applying directly\nconst requestChangeRole=(userId,newRole,username)=>{setConfirmUserId(userId);setConfirmNewRole(newRole);setConfirmUserName(username||\"\");setConfirmOpen(true);};const applyChangeRole=async()=>{const userId=confirmUserId;const newRole=confirmNewRole;setConfirmOpen(false);setSavingId(userId);try{const res=await putData(\"http://localhost:8080/api/users/\".concat(userId),{role:newRole});if(!res.ok)throw new Error();setUsers(prev=>prev.map(u=>u.id===userId?_objectSpread(_objectSpread({},u),{},{role:newRole}):u));}catch(e){console.error(e);alert('Error al actualizar rol');}finally{setSavingId(null);setConfirmUserId(null);setConfirmNewRole(null);setConfirmUserName(\"\");}};const filtered=users.filter(u=>{var _u$email,_u$fullName;const q=query.toLowerCase();return((_u$email=u.email)===null||_u$email===void 0?void 0:_u$email.toLowerCase().includes(q))||((_u$fullName=u.fullName)===null||_u$fullName===void 0?void 0:_u$fullName.toLowerCase().includes(q));});return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold mb-4\",children:\"Gesti\\xF3n de usuarios\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4 flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"input\",{value:query,onChange:e=>setQuery(e.target.value),placeholder:\"Buscar por usuario, correo o nombre\",className:\"border p-2 rounded w-full\"}),/*#__PURE__*/_jsx(\"button\",{onClick:loadUsers,className:\"bg-gray-200 hover:bg-gray-300 px-3 py-2 rounded transition-colors\",children:\"Recargar\"})]}),loading?/*#__PURE__*/_jsx(\"p\",{children:\"Cargando usuarios...\"}):/*#__PURE__*/_jsxs(\"ul\",{className:\"space-y-2\",children:[filtered.map(u=>/*#__PURE__*/_jsxs(\"li\",{className:\"bg-white p-3 rounded shadow flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"font-semibold\",children:[u.username,\" \",/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-gray-500\",children:[\"(\",u.email,\")\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:u.fullName})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsxs(\"select\",{value:u.role,onChange:e=>requestChangeRole(u.id,e.target.value,u.username),className:\"border rounded p-1\",disabled:savingId===u.id,children:[/*#__PURE__*/_jsx(\"option\",{value:\"USER\",children:\"user\"}),/*#__PURE__*/_jsx(\"option\",{value:\"EMPLOYEE\",children:\"employee\"}),/*#__PURE__*/_jsx(\"option\",{value:\"ADMIN\",children:\"admin\"})]}),savingId===u.id?/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-500\",children:\"Guardando...\"}):null]})]},u.id)),filtered.length===0&&/*#__PURE__*/_jsx(\"li\",{className:\"text-gray-500\",children:\"No se encontraron usuarios\"})]}),confirmOpen&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg p-6 w-96 shadow-lg\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-bold mb-2\",children:\"Confirmar cambio de rol\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"mb-4\",children:[\"\\xBFCambiar rol de \",/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:confirmUserName}),\" a \",/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:confirmNewRole.toLowerCase()}),\"?\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-3\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded w-full transition-colors\",onClick:()=>setConfirmOpen(false),children:\"Cancelar\"}),/*#__PURE__*/_jsx(\"button\",{className:\"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded w-full transition-colors\",onClick:applyChangeRole,children:\"Confirmar\"})]})]})})]});}","map":{"version":3,"names":["React","useEffect","useState","fetchData","putData","jsx","_jsx","jsxs","_jsxs","UsersSection","users","setUsers","query","setQuery","loading","setLoading","savingId","setSavingId","confirmOpen","setConfirmOpen","confirmUserId","setConfirmUserId","confirmNewRole","setConfirmNewRole","confirmUserName","setConfirmUserName","loadUsers","data","Array","isArray","e","console","error","requestChangeRole","userId","newRole","username","applyChangeRole","res","concat","role","ok","Error","prev","map","u","id","_objectSpread","alert","filtered","filter","_u$email","_u$fullName","q","toLowerCase","email","includes","fullName","children","className","value","onChange","target","placeholder","onClick","disabled","length"],"sources":["C:/WareHouse/school/dam_2do/proyecto/Proyecto Final/Cineverse_web/cineverse-web/src/components/common/UsersSection.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { fetchData, putData } from \"../../utils/api\";\r\n\r\nexport default function UsersSection() {\r\n    const [users, setUsers] = useState([]);\r\n    const [query, setQuery] = useState(\"\");\r\n    const [loading, setLoading] = useState(false);\r\n    const [savingId, setSavingId] = useState(null);\r\n    const [confirmOpen, setConfirmOpen] = useState(false);\r\n    const [confirmUserId, setConfirmUserId] = useState(null);\r\n    const [confirmNewRole, setConfirmNewRole] = useState(null);\r\n    const [confirmUserName, setConfirmUserName] = useState(\"\");\r\n    const loadUsers = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const data = await fetchData(\"http://localhost:8080/api/users\");\r\n      setUsers(Array.isArray(data) ? data : []);\r\n    } catch (e) {\r\n      console.error(e);\r\n      setUsers([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => { loadUsers(); }, []);\r\n\r\n  // Open confirmation modal instead of applying directly\r\n  const requestChangeRole = (userId, newRole, username) => {\r\n    setConfirmUserId(userId);\r\n    setConfirmNewRole(newRole);\r\n    setConfirmUserName(username || \"\");\r\n    setConfirmOpen(true);\r\n  };\r\n\r\n  const applyChangeRole = async () => {\r\n    const userId = confirmUserId;\r\n    const newRole = confirmNewRole;\r\n    setConfirmOpen(false);\r\n    setSavingId(userId);\r\n    try {\r\n      const res = await putData(`http://localhost:8080/api/users/${userId}`, { role: newRole });\r\n      if (!res.ok) throw new Error();\r\n      setUsers(prev => prev.map(u => u.id === userId ? { ...u, role: newRole } : u));\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert('Error al actualizar rol');\r\n    } finally {\r\n      setSavingId(null);\r\n      setConfirmUserId(null);\r\n      setConfirmNewRole(null);\r\n      setConfirmUserName(\"\");\r\n    }\r\n  };\r\n\r\n  const filtered = users.filter(u => {\r\n    const q = query.toLowerCase();\r\n    return (\r\n      u.email?.toLowerCase().includes(q) ||\r\n      u.fullName?.toLowerCase().includes(q)\r\n    );\r\n  });\r\n\r\n  return (\r\n    <div>\r\n      <h2 className=\"text-2xl font-bold mb-4\">Gestión de usuarios</h2>\r\n\r\n      <div className=\"mb-4 flex items-center gap-2\">\r\n        <input\r\n          value={query}\r\n          onChange={e => setQuery(e.target.value)}\r\n          placeholder=\"Buscar por usuario, correo o nombre\"\r\n          className=\"border p-2 rounded w-full\"\r\n        />\r\n        <button onClick={loadUsers} className=\"bg-gray-200 hover:bg-gray-300 px-3 py-2 rounded transition-colors\">Recargar</button>\r\n      </div>\r\n\r\n      {loading ? (\r\n        <p>Cargando usuarios...</p>\r\n      ) : (\r\n        <ul className=\"space-y-2\">\r\n          {filtered.map(u => (\r\n            <li key={u.id} className=\"bg-white p-3 rounded shadow flex items-center justify-between\">\r\n              <div>\r\n                <div className=\"font-semibold\">{u.username} <span className=\"text-sm text-gray-500\">({u.email})</span></div>\r\n                <div className=\"text-sm text-gray-600\">{u.fullName}</div>\r\n              </div>\r\n\r\n              <div className=\"flex items-center gap-2\">\r\n                <select\r\n                  value={u.role}\r\n                  onChange={e => requestChangeRole(u.id, e.target.value, u.username)}\r\n                  className=\"border rounded p-1\"\r\n                  disabled={savingId === u.id}\r\n                >\r\n                  <option value=\"USER\">user</option>\r\n                  <option value=\"EMPLOYEE\">employee</option>\r\n                  <option value=\"ADMIN\">admin</option>\r\n                </select>\r\n                {savingId === u.id ? <span className=\"text-sm text-gray-500\">Guardando...</span> : null}\r\n              </div>\r\n            </li>\r\n          ))}\r\n\r\n          {filtered.length === 0 && (\r\n            <li className=\"text-gray-500\">No se encontraron usuarios</li>\r\n          )}\r\n        </ul>\r\n      )}\r\n\r\n      {/* Confirm modal */}\r\n      {confirmOpen && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\">\r\n          <div className=\"bg-white rounded-lg p-6 w-96 shadow-lg\">\r\n            <h3 className=\"text-lg font-bold mb-2\">Confirmar cambio de rol</h3>\r\n            <p className=\"mb-4\">¿Cambiar rol de <span className=\"font-semibold\">{confirmUserName}</span> a <span className=\"font-semibold\">{confirmNewRole.toLowerCase()}</span>?</p>\r\n            <div className=\"flex gap-3\">\r\n              <button className=\"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded w-full transition-colors\" onClick={() => setConfirmOpen(false)}>Cancelar</button>\r\n              <button className=\"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded w-full transition-colors\" onClick={applyChangeRole}>Confirmar</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}